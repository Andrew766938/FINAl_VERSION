# üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î —Å Alembic

## –ü–µ—Ä–≤—ã–π —Ä–∞–∑

### 1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

```bash
pip install alembic sqlalchemy aiosqlite
```

### 2Ô∏è‚É£ –û—Å—Ç–∞–Ω–æ–≤–∏ —Ç–µ–∫—É—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ —ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)
Ctrl+C

# –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—É—é –ë–î (–µ—Å–ª–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã)
rm betony.db 2>/dev/null || true

# –£–¥–∞–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –≤–µ—Ä—Å–∏—è–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (SQLAlchemy)
rm -rf alembic/__pycache__ || true
```

### 3Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–∏ –∞–ª–µ–º–±–∏–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–∏–º–µ–Ω–∏ –í–°–ï –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –û—Ä–¥–µ—Ä–µ
alembic upgrade head
```

–û—á–µ–∫–∏–≤–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
[alembic.runtime.migration] Context impl SQLiteImpl.
[alembic.runtime.migration] Will assume non-transactional DDL.
[alembic.runtime.migration] Running upgrade  -> 001_initial, Create all initial tables
‚úÖ Created table: roles
‚úÖ Created table: users
‚úÖ Created table: posts
‚úÖ Created table: comments
‚úÖ Created table: likes
‚úÖ Created table: friendships
```

### 4Ô∏è‚É£ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

```bash
# –ó–∞–ø–æ–ª–Ω–∏ –±–∞–∑—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
python init_db.py
```

–û—á–µ–∫–∏–≤–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  BETONY DATABASE INITIALIZATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

[DATABASE] Initializing database...

[DROP] Dropped all tables
[CREATE] Created all tables

[ACCOUNTS] Creating 3 test accounts...

‚úÖ Admin: admin@betony.local (password: admin123) [ID: 1]
‚úÖ User: test@betony.local (password: test123) [ID: 2]
‚úÖ Guest: guest@betony.local (no password needed)

[SUCCESS] All accounts created successfully!

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
ACCOUNT CREDENTIALS:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1Ô∏è‚É£  ADMIN ACCOUNT (Full privileges)
   Email: admin@betony.local
   Password: admin123

2Ô∏è‚É£  REGULAR USER ACCOUNT (Normal user)
   Email: test@betony.local
   Password: test123

3Ô∏è‚É£  GUEST MODE (No login needed)
   Click: '–ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º' button on login
```

### 5Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
python main.py
```

–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:8000
```

## üìö –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

### –ö–æ–≥–¥–∞ —Ç—ã –¥–æ–±–∞–≤–ª—è–µ—à—å –Ω–æ–≤—ã–µ –ø–æ–ª—è/—Ç–∞–±–ª–∏—Ü—ã

```bash
# 1. –û–±–Ω–æ–≤–∏ –º–æ–¥–µ–ª—å
# –ù–∞–ø—Ä–∏–º–µ—Ä: –≤ app/models/users.py –¥–æ–±–∞–≤–∏–ª –Ω–æ–≤–æ–µ –ø–æ–ª–µ

# 2. –°–æ–∑–¥–∞–π –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Add new_field to users"

# 3. –ü–æ—Å–º–æ—Ç—Ä–∏ –ø–æ–ª—É—á–µ–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
# alembic/versions/002_add_new_field_to_users.py

# 4. –ò—Å–ø—Ä–∞–≤—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)

# 5. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head
```

### –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∞–π —ç—Ç–æ

‚ùå **–ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Å—Ç–∞—Ä—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - —Å–æ–∑–¥–∞–≤–∞–π –Ω–æ–≤—ã–µ

‚ùå **–ù–ï —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π betony.db** - —Ç–æ–ª—å–∫–æ –º–∏–≥—Ä–∞—Ü–∏–∏

‚ùå **–ù–ï –ø—Ä—ã–≥–∞–π –º–∏–≥—Ä–∞—Ü–∏–∏** - –ø—Ä–∏–º–µ–Ω—è–π –æ –≥–ª–∞–≤–Ω–æ–π –≤–µ—Ä—Å–∏–∏

## üîì –ù–∏–∂–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–û—Ç–∫–∞—Ç–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω—ã –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é:

```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –ù–ê 1 –º–∏–≥—Ä–∞—Ü–∏—é –≤–±–∞–∫
# (—Å—Ç–∞–Ω–µ—Ç –±–µ–∑ —Ç–∞–±–ª–∏—Ü –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π)
alembic downgrade -1

# –û—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é
alembic downgrade 001_initial

# –û—Ç–∫–∞—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É (—Ç–∞–±–ª–∏—Ü –±–æ–ª—å—à–µ –Ω–µ—Ç)
alembic downgrade base
```

## üö® –û—à–∏–±–∫–∏ –∏ –Ω–µ–ø–æ–ª–∞–¥–∫–∏

### –û—à–∏–±–∫–∞: `ModuleNotFoundError: No module named 'app'`

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -e .

# –û—Ä –≤—ã—Ç–≤–∏ alembic —Ç–∞–∫
cd /path/to/project
alembic upgrade head
```

### –û—à–∏–±–∫–∞: `sqlite3.IntegrityError: UNIQUE constraint failed`

```bash
# –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–∑–≤–∞–ª–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç
# –û—Ç–∫–∞—Ç–∏ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏ –±–∞–∑—É
alembic downgrade base
rm betony.db
alembic upgrade head
python init_db.py
```

### –ß—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å?

```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É –±–∞–∑—ã
alembic current

# –ü–æ—Å–º–æ—Ç—Ä–∏ –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
alembic history --verbose

# –û—Ç–∫–∞—Ç–∏ –≤—Å–µ
# –û—Å—Ç–∞–Ω–æ–≤–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
alembic downgrade base

# –£–¥–∞–ª–∏ –∏ —Å–Ω–æ–≤–∞
# –ù–∞—á–Ω–∏ —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞
rm betony.db 2>/dev/null || true
alembic upgrade head
python init_db.py
```

## üçê –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–∏–º–µ–Ω–∏ –≤—Å–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ü–æ–∫–∞–∂–∏ SQL –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head --sql

# –û—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ
alembic downgrade base

# –ü–æ–∫–∞–∂–∏ —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è
alembic current

# –ü–æ–∫–∞–∂–∏ –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic history
```

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —è –º–æ–∂–Ω–æ —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–æ–π –í–ï–†–°–ò–û–ù–û–í–ê–ù–ù—ã–º–∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏! üäâ

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Git –∏ —Ç—Ä–∞–∑–∏—é—Ç—Å—è –Ω–∞–¥–ª–µ–∂–∞—â–∏–º –æ–±—Ä–∞–∑–æ–º.
